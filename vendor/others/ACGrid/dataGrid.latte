{snippet grid}

	{* ====== DEFINITION LAYERS ================== *}

	{snippet stencils}
		{foreach $stencils as $stencil}
			{includeblock $stencil}
		{/foreach}
	{/snippet}

	{* ====== FLASH MESSAGES ===================== *}

	{define flashes}
		<div n:snippet="flashes">
			<p class="alert alert-{$flash->type === 'error' ? 'danger' : $flash->type}" n:foreach="$flashes as $flash">
				{$flash->message}
			</p>
		</div>
	{/define}

	{* ====== HEADER ============================= *}

	{define header}
		<tr n:snippet="header">
			{foreach $columns as $column}
				<th>
					{var $colname = $column->name}
					{var $collabel = $column->label ?: Strings::firstUpper($colname)}
					{var $sort = array_search($colname, $sort_cols)}
					{if $sort !== FALSE}
						{var $dir = !empty($sort_dirs[$colname]) ? $sort_dirs[$colname] : FALSE}
						<a n:href="server! $cmd['ORDER'], $colname" class="ajax">
							{$collabel}
							<span class="glyphicon {if $dir === 1}glyphicon-sort-by-alphabet
													{elseif $dir === 2}glyphicon-sort-by-alphabet-alt{/if}"></span>
						</a>
					{else}
						{$collabel}
					{/if}
				</th>
			{/foreach}
			<th n:if="$actions" class="col-sm-{$action_width}">
				<a n:if="$adding" n:href="server! $cmd['ADD']"
						class="ajax btn btn-primary btn-xs" role="button">
					<span class="glyphicon glyphicon-plus"></span> {$labels['new']}
				</a>
			</th>
		</tr>
	{/define}

	{* ====== LINE =============================== *}

	{define line}
		<tr n:snippet="line-{$row->id}">
			{foreach $columns as $column}
				<td>
					{var $colname = $column->name}
					{var $colblock = "col-{$colname}"}
					{if $row->id === $id}
						{formContainer inner}
							{input $colname, class => 'form-control'}
						{/formContainer}
					{else}
						{ifset #$colblock}
							{include #$colblock, row => $row}
						{else}
							{$row->$colname}
						{/ifset}
					{/if}
				</td>
			{/foreach}
			<td n:if="$actions">
				{if $row->id === $id}
					{include #edit-form-buttons, labels => $labels}
				{else}
					{include #line-buttons, row => $row, cmd => $cmd, editable => $editable, removable => $removable,
					label => $labels}
				{/if}
			</td>
		</tr>
	{/define}

	{define edit-form-buttons}
		{input save class => "btn btn-primary btn-xs"}
		{input cancel class => "btn btn-default btn-xs"}
	{/define}

	{define line-buttons}
		<a n:if="$editable" n:href="server! $cmd['EDIT'], $row->id" class="ajax btn btn-primary btn-xs" role="button">
			<span class="glyphicon glyphicon-pencil"></span> {$labels['edit']}
		</a>
		<a n:if="$removable" n:href="server! $cmd['REMOVE'], $row->id" class="ajax btn btn-default btn-xs"
		                                                               role="button">
			<span class="glyphicon glyphicon-minus"></span> {$labels['remove']}
		</a>
	{/define}

	<div class="container">
		{include #flashes}

		{form editForm}
			<table class="table table-bordered table-striped">
				{var $colspan = count($columns) + ($actions ? 1 : 0)}

				<thead>
				<tr n:if="$actitle">
					<td colspan="{$colspan}"><h2>{$actitle}</h2></td>
				</tr>
				{include #header, columns => $columns, sort_cols => $sort_cols, sort_dirs => $sort_dirs,
							 cmd => $cmd, action => $actions, actions_width => $action_width, adding => $adding,
							 labels => $labels}
				</thead>
				{snippet data}
					<tbody>
					{foreach $data as $row}
						{include #line, row => $row, columns => $columns, id => $id, cmd => $cmd,
									editable => $editable, removable => $removable, actions => $actions,
									labels => $labels}
					{/foreach}
					</tbody>
				{/snippet}
				<tfoot>
				<td colspan="{$colspan}">{$acfooter}</td>
				</tfoot>
			</table>
		{/form}
	</div>

{/snippet}