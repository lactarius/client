{* ====== FLASH MESSAGES ===================== *}

{define flashes}
	<div n:snippet="flashes">
		<p class="alert alert-{$flash->type === 'error' ? 'danger' : $flash->type}" n:foreach="$flashes as $flash">
			{$flash->message}
		</p>
	</div>
{/define}

{snippet grid}

	{* ====== LINE =============================== *}

	{define line}
		<tr n:snippet="line-{$row->id}">
			{foreach $columns as $column}
				<td>
					{var $colname = $column->name}
					{var $colblock = "col-{$colname}"}
					{if $row->id === $id}
						{formContainer inner}
							{input $colname, class => 'form-control'}
						{/formContainer}
					{else}
						{include #$colblock, row => $row}
					{/if}
				</td>
			{/foreach}
			<td n:if="$actions">
				{if $row->id === $id}
					{include #edit-form-buttons, labels => $labels}
				{else}
					{include #line-buttons, row => $row, cmd => $cmd, editable => $editable, removable => $removable,
					label => $labels}
				{/if}
			</td>
		</tr>
	{/define}

	{define edit-form-buttons}
		{input save class => "btn btn-primary btn-xs"}
		{input cancel class => "btn btn-default btn-xs"}
	{/define}

	{define line-buttons}
		<a n:if="$editable" n:href="server! $cmd['EDIT'], $row->id" class="ajax btn btn-primary btn-xs" role="button">
			<span class="glyphicon glyphicon-pencil"></span> {$labels['edit']}
		</a>
		<a n:if="$removable" n:href="server! $cmd['REMOVE'], $row->id" class="ajax btn btn-default btn-xs"
		                                                               role="button">
			<span class="glyphicon glyphicon-minus"></span> {$labels['remove']}
		</a>
	{/define}

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-{$width}">
				{include #flashes}

				{form editForm}
					<table class="table table-bordered table-striped">
						{snippet interior}
							{var $colspan = count($columns) + ($actions ? 1 : 0)}

							{* ====== DEFINITION LAYERS ================== *}

							{foreach $stencils as $stencil}
								{includeblock $stencil}
							{/foreach}

							<thead>
							<tr n:if="$actitle">
								<td colspan="{$colspan}"><h2>{$actitle}</h2></td>
							</tr>
							<tr>
								{foreach $columns as $column}
									<th>{$column->label}</th>
								{/foreach}
								<th n:if="$actions" class="col-sm-{$action_width}">
									<a n:if="$adding" n:href="server! $cmd['ADD']" class="ajax btn btn-primary btn-xs"
									                                               role="button">
										<span class="glyphicon glyphicon-plus"></span> {$labels['new']}
									</a>
								</th>
							</tr>
							</thead>
							<tbody>
							{foreach $data as $row}
								{include #line, row => $row, columns => $columns, id => $id, cmd => $cmd,
								editable => $editable, removable => $removable, actions => $actions,
								labels => $labels}
							{/foreach}
							</tbody>
							<tfoot>
							<td colspan="{$colspan}">ACGrid</td>
							</tfoot>
						{/snippet}
					</table>
				{/form}
			</div>
		</div>
	</div>

{/snippet}